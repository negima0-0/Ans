import csv

# CSVファイルパス
csv_file_path = 'hosts.csv'

# 接頭辞と地域名の対応表
region_mapping = {
    'kn': 'kanagawa',
    'mg': 'miyagi'
    # 他の地域接頭辞もここに追加可能
}

# 地域ごとおよび機能ごとのホストリストを保持するディクショナリ
hosts_dict = {
    'GW': [],
    'DSW': [],
    'ASW': [],
    'SW': [],
    'RT': []
}

# 地域ごとのサイト情報を保持するディクショナリ
regions_dict = {}

# CSVファイルを読み込み、データを処理
with open(csv_file_path, newline='') as csvfile:
    reader = csv.DictReader(csvfile)
    for row in reader:
        site = row['site']
        hostname = row['hostname']
        ip_address = row['IP_address']
        region_prefix = hostname.split('-')[0][:2]  # 最初の2文字を地域接頭辞として使用

        # 地域名に変換
        region_name = region_mapping.get(region_prefix, 'unknown')  # 対応する地域名がない場合は 'unknown'

        # 地域情報を更新
        if region_name not in regions_dict:
            regions_dict[region_name] = []
        regions_dict[region_name].append(f"{hostname} ansible_host={ip_address}")
        
        # 機能グループ情報を更新
        if 'gw' in hostname:
            hosts_dict['GW'].append(hostname)
        elif 'dsw' in hostname:
            hosts_dict['DSW'].append(hostname)
        elif 'asw' in hostname:
            hosts_dict['ASW'].append(hostname)
        elif 'sw' in hostname and 'dsw' not in hostname and 'asw' not in hostname:
            hosts_dict['SW'].append(hostname)
        elif 'rt' in hostname:
            hosts_dict['RT'].append(hostname)

# インベントリファイルを生成
with open('inventory.ini', 'w') as inv_file:
    for region, hosts in regions_dict.items():
        inv_file.write(f"[{region}]\n")
        for host in hosts:
            inv_file.write(f"{host}\n")
        inv_file.write("\n")

    for group, hosts in hosts_dict.items():
        inv_file.write(f"[{group}]\n")
        for host in hosts:
            inv_file.write(f"{host}\n")
        inv_file.write("\n")
    
    inv_file.write("[all:vars]\nansible_connection=network_cli\n")

print("インベントリファイル 'inventory.ini' が生成されました。")
