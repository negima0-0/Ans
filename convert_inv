import csv

# CSVファイルパス
csv_file_path = 'hosts.csv'

# 接頭辞と地域名の対応表
region_mapping = {
    'kn': 'kanagawa',
    'mg': 'miyagi'
    # 他の地域接頭辞もここに追加可能
}

# 地域ごと、サイトごと、機能ごとのホストリストを保持するディクショナリ
regions_sites = {}

# CSVファイルを読み込み、データを処理
with open(csv_file_path, newline='') as csvfile:
    reader = csv.DictReader(csvfile)
    for row in reader:
        site = row['site']
        hostname = row['hostname']
        ip_address = row['IP_address']
        region_prefix = hostname.split('-')[0][:2]  # 最初の2文字を地域接頭辞として使用
        region_name = region_mapping.get(region_prefix, 'unknown')  # 対応する地域名がない場合は 'unknown'

        # 地域とサイト情報を更新
        if region_name not in regions_sites:
            regions_sites[region_name] = {}
        if site not in regions_sites[region_name]:
            regions_sites[region_name][site] = {'GW': [], 'DSW': [], 'ASW': [], 'SW': [], 'RT': []}

        # 機能グループ情報を更新
        if 'gw' in hostname:
            regions_sites[region_name][site]['GW'].append(f"{hostname} ansible_host={ip_address}")
        elif 'dsw' in hostname:
            regions_sites[region_name][site]['DSW'].append(f"{hostname} ansible_host={ip_address}")
        elif 'asw' in hostname:
            regions_sites[region_name][site]['ASW'].append(f"{hostname} ansible_host={ip_address}")
        elif 'sw' in hostname:
            regions_sites[region_name][site]['SW'].append(f"{hostname} ansible_host={ip_address}")
        elif 'rt' in hostname:
            regions_sites[region_name][site]['RT'].append(f"{hostname} ansible_host={ip_address}")

# インベントリファイルを生成
with open('inventory.ini', 'w') as inv_file:
    for region, sites in regions_sites.items():
        inv_file.write(f"[{region}]\n")
        for site, groups in sites.items():
            inv_file.write(f"\n[{region}:{site}]\n")
            for group, hosts in groups.items():
                if hosts:  # ホストが存在する場合のみグループを作成
                    inv_file.write(f"\n[{region}:{site}:{group}]\n")
                    for host in hosts:
                        inv_file.write(f"{host}\n")
    inv_file.write("\n[all:vars]\nansible_connection=network_cli\n")

print("インベントリファイル 'inventory.ini' が生成されました。
